<script>
    document.getElementById('location-request-button').addEventListener('click', function() {
        const button = document.getElementById('location-request-button');
        const defaultText = button.textContent;
        
        if ("geolocation" in navigator) {
            // Show waiting state
            button.textContent = "Waiting for permissions...";
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    console.log(`User location - Latitude: ${latitude}, Longitude: ${longitude}`);
                    // Redirect to the near-me search with coordinates
                    window.location.href = `/search/stops/nearby?latitude=${latitude}&longitude=${longitude}`;
                }, 
                function(error) {
                    console.error("Error getting location:", error.message);
                    if (error.code === error.PERMISSION_DENIED) {
                        button.textContent = "Permissions are required ðŸ˜”";
                    } else {
                        button.textContent = "Error getting location ðŸ˜•";
                    }
                    button.disabled = true;
                }
            );
        } else {
            console.error("Geolocation is not supported by this browser");
            button.textContent = "Location isn't supported on your device ðŸ˜¢";
            button.disabled = true;
        }
    });
</script>
